# EDKII Dp.efi Log Processing Toolkit

This toolkit, located in the `bios-tools/DpLogProcess` directory of the [BinTools](https://github.com/BinsonWu/BinTools) repository, contains Python scripts for parsing and analyzing EDKII `Dp.efi` log files generated by the UEFI firmware's Dependency Performance (DP) utility. It extracts sections (Major Phases, Drivers, PEIMs, and General), converts them into Markdown tables, generates Excel reports, and compares performance metrics between two logs. The toolkit is cross-platform, supporting both Windows and Linux.

## Purpose

The toolkit helps UEFI firmware developers:
- Extract and organize performance data from `Dp.efi` logs.
- Analyze timing metrics for Major Phases (e.g., SEC, PEI, DXE, BDS), Drivers, PEIMs, and General components.
- Compare two logs to identify performance differences, aiding in firmware optimization.

## Directory Structure

```
bios-tools/DpLogProcess/
├── Source/
│   ├── DpLogProcess.py         # Processes a single Dp.efi log file
│   ├── DpLogCompare.py         # Compares two Dp.efi log files
│   ├── LogCapture.py           # Extracts sections from a log file
│   ├── ProcessData.py          # Processes sections into Markdown tables
│   ├── MdCombineToExcel.py     # Combines Markdown files into an Excel report
│   ├── CompareTime.py          # Compares two Markdown files
├── Log/                        # Sample log files (not tracked)
├── Output/                     # Generated files (not tracked)
├── README.md                   # This file
├── requirements.txt            # Python dependencies
├── LICENSE                     # MIT License
└── .gitignore                  # Git ignore rules
```

## Prerequisites

- **Python 3.8+**: Required for running all scripts.
- **Required Python Packages**:
  Install dependencies using:
  ```bash
  pip install -r requirements.txt
  ```
  Includes: `pandas`, `openpyxl`, `tabulate`.

## Installation

1. Clone the repository:
   ```bash
   git clone https://github.com/BinsonWu/BinTools.git
   cd BinTools/bios-tools/DpLogProcess
   ```
2. Install dependencies:
   ```bash
   pip install -r requirements.txt
   ```

## Usage

### Processing a Single Dp.efi Log File
Run `DpLogProcess.py` to process a single `Dp.efi` log file:
```bash
python Source/DpLogProcess.py Log/dp_log.log
```
**Example**:
- Windows: `python Source/DpLogProcess.py Log\dp_log.log`
- Linux: `python Source/DpLogProcess.py Log/dp_log.log`

This will:
1. Extract sections using `LogCapture.py`.
2. Process sections into Markdown tables using `ProcessData.py`.
3. Generate an Excel report using `MdCombineToExcel.py`.
4. Save results in `Output/<logfile_basename>/`.

### Comparing Two Dp.efi Log Files
Run `DpLogCompare.py` to compare two `Dp.efi` log files:
```bash
python Source/DpLogCompare.py Log/dp_log1.log Log/dp_log2.log
```
**Example**:
- Windows: `python Source/DpLogCompare.py Log\dp_log1.log Log\dp_log2.log`
- Linux: `python Source/DpLogCompare.py Log/dp_log1.log Log/dp_log2.log`

This will:
1. Process each log file using `DpLogProcess.py`.
2. Compare Markdown files using `CompareTime.py`.
3. Generate a comparison Excel report in `Output/`.

## Expected Log File Format

`Dp.efi` logs contain sections marked with headers like `==[ Major Phases ]========`, `==[ Drivers by Handle ]========`, `==[ PEIMs ]========`, and `==[ General ]========`. Example:

```
==[ Major Phases ]========
Reset End:        1000 us
SEC Phase Duration:  2000 us
...
==[ Drivers by Handle ]========
Index:  Handle  Driver Name  Description  Time(us)
0:  [0x1234]  DriverA  Initializes hardware  1500
...
```

Logs should be `.log` files in UTF-8 or UTF-16 encoding.

## Scripts Overview

- **DpLogProcess.py**: Processes a single log file into Markdown and Excel.
- **DpLogCompare.py**: Compares two log files, generating comparison reports.
- **LogCapture.py**: Extracts sections into text files.
- **ProcessData.py**: Converts text files into Markdown tables.
- **CompareTime.py**: Compares Markdown files for performance differences.
- **MdCombineToExcel.py**: Combines Markdown files into Excel sheets.

## Output

- **Processed Files**: Markdown files (e.g., `Output/dp_log/dp_log_Major.md`) and Excel reports (e.g., `Output/dp_log/dp_log.xlsx`).
- **Comparison Files**: Comparison Markdown files (e.g., `Output/dp_log1_dp_log2_Major.md`) and Excel reports (e.g., `Output/dp_log1_dp_log2.xlsx`).

## Cross-Platform Notes

- Uses `pathlib` for Windows and Linux path compatibility.
- Specify paths appropriately (e.g., `Log\dp_log.log` on Windows, `Log/dp_log.log` on Linux).

## Troubleshooting

- **Blank Excel File**: Ensure `tabulate` is installed (`pip install tabulate`) and check comparison Markdown files (e.g., `Output/dp_log1_dp_log2_Major.md`).
- **Invalid Log Format**: Verify logs have expected section headers.
- **Encoding Issues**: Use UTF-8 or UTF-16 encoded logs.
- **Dependencies**: Run `pip install -r requirements.txt`.

## License

Licensed under the MIT License. See [LICENSE](LICENSE) for details.

## Contributing

Submit pull requests or issues on [GitHub](https://github.com/BinsonWu/BinTools) for enhancements or bug fixes, especially for new `Dp.efi` log formats.